---
title: 'KNN Model'
author: "Patrick Bigler, Nils Tinner"
date: "2023-04-03"
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: yes
  '': default
editor_options:
  markdown:
    wrap: 75
---




```{r preparation}
use_pkgs <-  c("dplyr", "tidyr", "readr", "lubridate", "stringr", "purrr",
               "ggplot2", "tidyverse", "visdat", "terra", "hexbin", "jsonlite",
               "MODISTools", "forcats", "yardstick", "recipes", "caret",
               "broom", "skimr", "cowplot", "scico", "hwsdr", "usethis",
               "renv", "rsample", "modelr", "rmarkdown", "rpart",
               "rpart.plot", "ranger", "sessioninfo", "ncdf4")

new_pkgs <- use_pkgs[!(use_pkgs %in% installed.packages()[, "Package"])]
if (length(new_pkgs) > 0) install.packages(new_pkgs,repos = "http://cran.us.r-project.org")
invisible(lapply(use_pkgs, require, character.only = TRUE))


combined <- read_csv("../data/Combined.csv")


combined <- combined |>
    filter(complete.cases(across(all_of(tiff_names_short)))) |>
    dplyr::select(all_of(c(tiff_names_short,meteoswiss_names)),temperature,hour,month,year,day,Log_Nr) |> drop_na()


# We calculate a KNN Model with cross validation as method
mod_cv <- caret::train(pp, data = combined_train |> drop_na(),
                         method = "knn",
                         trControl = caret::trainControl(method = "cv", 3),
                         tuneGrid = data.frame(k = c(5,10, 15)),
                         metric = "MAE")
```














